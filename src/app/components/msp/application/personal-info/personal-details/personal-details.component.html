<msp-services-card-disclaimer-modal #mspServicesCardModal
                                    ></msp-services-card-disclaimer-modal>
<form #formRef='ngForm' novalidate>
    <div class="row">
        <div class="col-sm-8">
            <h2 [innerHTML]="lang('./en/index.js').sectionTitle[person.relationship]"></h2>
        </div>
        <div class="col-sm-4">
            <div *ngIf="person.relationship !== 0" style="margin-top: 18px">
                <div *ngIf="person.relationship === 1">
                    <button type="button" class="btn btn-default btn-xs pull-right"
                            (click)="removeSpouse()"
                            [innerHTML]="lang('./en/index.js').removeSpouseButton">
                    </button>
                </div>
                <div *ngIf="person.relationship === 2 || person.relationship === 3 ">
                    <button type="button" class="btn btn-default btn-xs pull-right"
                            (click)="removeChild()"
                            [innerHTML]="lang('./en/index.js').removeChildButton">
                    </button>
                </div>
            </div>
        </div>
    </div>
<div>

    <div>
        <h3 [innerHtml]="lang('./en/index.js').applicationPersonalInfo[person.relationship]"></h3>
        <p class="help-block" [innerHtml]="lang('./en/index.js').nameHelpBlock[this.person.relationship]"></p>
        <msp-name #name [person]="person" (onChange) = "setAddressOnchange($event); onChange.emit($event)" [showError]="showError"></msp-name>

        <div class="row">
            <div class="col-md-4" >
                <msp-health-number #healthNumber
                                    [healthNumber]="person.nationalInsuranceNumber"
                                    (healthNumberChange)="handleHealthNumberChange($event)"
                                    [required]="false"
                                    [showError]="showError"
                                    >
                </msp-health-number>
            </div> 
            <div class="col-md-4 form-group"  [ngClass]="{'has-error': !formRef.controls.schoolName?.valid && (schoolNameRef.touched || showError)}" >
                    <label  for="schoolName" class="control-label">Unique Identifier</label>
                    <input [(ngModel)]='person.uid' type="text" class="form-control"  pattern="^[A-Za-z]{3}\d{9}$" required="true" placeholder="AAA999999999"
                    id="schoolName" name="schoolName" #schoolNameRef="ngModel" (keyup)="showinfomsg(); onKeydownEvent()"
                    maxlength="12">


                <div *ngIf='!formRef.controls.schoolName?.valid && showInfomessage && (!schoolNameRef.touched )' role="alert" aria-live="assertive">
                    <div
                    > Unique Identifier should be of the format AAA999999999</div>
                </div>
                <div *ngIf='!formRef.controls.schoolName?.valid && (schoolNameRef.touched || showError)' role="alert" aria-live="assertive">
                    <div class="text-danger"
                    > Unique Identifier should be of the format AAA999999999</div>
                </div>
            </div>

        </div>
        <!--------------------------Gender DOB questions -------------<b>{{this.hideAddress}}</b>-->
        <div *ngIf="this.showGenderDob">
            <div class="row">
                <div class="col-md-4">
                    <msp-gender
                    #gender
                    [person]="person"
                    (onChange) = "onKeydownEvent(); onChange.emit($event)" 
                    [showError] = "showError"
                    ></msp-gender>
                </div>
                <div class="col-md-8">
                    <msp-birthdate
                    #birthDate
                    [person]="person" 
                    (onChange) = "onKeydownEvent(); onChange.emit($event)"
                    [showError] = "showError">
                    </msp-birthdate>
                </div>
            </div>
        </div>

     <!--   <div *ngIf="this.showMoveAroundQues" style="margin-bottom: 20px">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group"
                         [ngClass]="{'has-error': showError && (person.canMoveAround === undefined || person.canMoveAround === null)}"
                         role="dialog" [attr.aria-labelledby]="'outsideBCLabel' + objectId">
                      <label id="outsideBCLabel{{objectId}}" [innerHtml]="lang('./en/index.js').beenOutsideBCForMoreThan30DaysInTotalInThePast12Months" class="control-label"></label>
                      <div class="btn-group" role="group">
                          <button *ngFor='let answer of [{"value": true, "label": "Yes"}, {"value": false, "label": "No"}]'
                                  [class.msp-btn-radio]="person.canMoveAround === answer.value"
                                  (click)="setBeenOutsideForOver30Days(answer.value)"
                                  type="button" class="btn btn-default">{{answer.label}}
                          </button>
                      </div>
                      <div *ngIf='showError && (person.canMoveAround === undefined || person.canMoveAround === null)'
                           role="alert" aria-live="assertive">
                          <div class="text-danger" 
                              [innerHtml]="lang('./en/index.js').mustAnswerQuestionAboutBeenOutsideBC"></div>
                      </div>
                    </div>
                </div>
            </div>
        </div>-->
        <!--Can you move around and use steps without difficulty YES/NO-->
        <div *ngIf="this.showMoveAroundQues" class="row" style="margin-bottom: 20px" >
            <div class="col-lg-8">
            <label id="canMoveAround" [innerHtml]="lang('./en/index.js').beenOutsideBCForMoreThan30DaysInTotalInThePast12Months" class="control-label"></label>
            <div class="btn-group" role="group">
                <button *ngFor='let answer of [{"value": true, "label": "Yes"}, {"value": false, "label": "No"}]'
                        [class.msp-btn-radio]="person.canMoveAround == answer.value"
                        (click)="setBeenOutsideForOver30Days(answer.value)"
                        type="button" class="btn btn-default">{{answer.label}}
                </button>
            </div>
            </div>
    
        </div>

        <!--Can you go up or move down two steps without difficulty? YES/NO-->
        <div *ngIf="this.showUpandDownQues" class="row" style="margin-bottom: 20px">
            <div class="col-lg-6">
              <div class="form-group"
                 [ngClass]="{'has-error': (person.canMoveUpandDown === undefined || person.canMoveUpandDown === null) && showError}"
                 role="dialog" [attr.aria-labelledby]="'previousBCHealthNumber' + objectId">
              
                <label id="previousBCHealthNumber{{objectId}}" [innerHtml]="lang('./en/index.js').previousBCHealthNumber[this.person.relationship]"
                  class="control-label"></label>
                <div class="btn-group" role="group">
                    <button [class.msp-btn-radio]="person.canMoveUpandDown"
                            (click)="setHasPreviousPhn(true)"
                            type="button" class="btn btn-default" >Yes</button>
                    <button [class.msp-btn-radio]="person.canMoveUpandDown === false"
                            (click)="setHasPreviousPhn(false)"
                            type="button" class="btn btn-default">No&nbsp;</button>
                </div>

              </div>
              
            </div>
        </div>

        <!-- Address Question Block-->
        <div *ngIf="this.showAddress" class="row">
            <div class="col-md-12" >
            <msp-address #address
                [residentialAddress]="person.mailingAddress"
                [mailingAddress]="person.mailingAddress"
                [mailingSameAsResidentialAddress]="person.mailingSameAsResidentialAddress"
                (mailingSameAsResidentialAddressChange)="toggleMailingSameAsResidentialAddress($event)"
                (onChange)="handleAddressUpdate($event)"
                [showError] = "showError">

            </msp-address>
            </div>
        </div>
            

    
 
 
    <div class="row" *ngIf="person.relationship === Relationship.Child19To24">
        <div class="form-group col-lg-6"
            [ngClass]="{'has-error': !formRef.controls.schoolName?.valid && (schoolNameRef.touched || showError)}">
            <h2 [innerHtml]="lang('./en/index.js').nameOfSchool"></h2>
            <label [innerHtml]="lang('./en/index.js').fullAttendanceLabel"></label>
            <label class="visuallyhidden" for="schoolName{{objectId}}">{{lang('./en/index.js').nameOfSchool}} {{lang('./en/index.js').fullAttendanceLabel}}></label>
            <input [(ngModel)]='person.schoolName' type="text" class="form-control"
                id="schoolName{{objectId}}" name="schoolName" #schoolNameRef="ngModel"
                required
                maxlength="50">
            <div *ngIf='schoolNameRef.touched || showError' role="alert" aria-live="assertive">
                <div class="text-danger" *ngIf="schoolNameRef.errors?.required"
                    [innerHtml]="lang('./en/index.js').schoolNameErrorIsRequired"></div>
            </div>
        </div>
    </div>
    <msp-address #schoolAddress
                *ngIf="person.relationship === Relationship.Child19To24"
                [mailingAddressHeading]="lang('./en/index.js').schoolAddressLabel"
                [mailingAddress]="person.schoolAddress"
                [mailingOnly]="true"
                (onChange)="schoolAddressUpdate($event)"
                [showError] = "showError"
                >
    </msp-address>
</div>

    <div class="row" *ngIf="person.documents.images.length > 0 &&
                            person.relationship === Relationship.Child19To24">
        <div class="form-group col-lg-6">
            <msp-school-date #schoolDate
                            [departureDate]="true"
                            [year]="person.studiesDepartureYear"
                            [required]="schoolInBC"
                            (yearChange)="person.studiesDepartureYear = $event"
                            [month]="person.studiesDepartureMonth"
                            (monthChange)="person.studiesDepartureMonth = $event"
                            [day]="person.studiesDepartureDay"
                            (dayChange)="person.studiesDepartureDay = $event"
                            (onChange) = "updateSchoolDepartureDate($event)"
                            [showError] = "showError"
                            >
            </msp-school-date>
        </div>
        <div class="form-group col-lg-4">
            <msp-school-date [year]="person.studiesFinishedYear"
                            (yearChange)="person.studiesFinishedYear = $event"
                            [month]="person.studiesFinishedMonth"
                            (monthChange)="person.studiesFinishedMonth = $event"
                            [day]="person.studiesFinishedDay"
                            (dayChange)="person.studiesFinishedDay = $event"
                            (onChange) = "updateSchoolExpectedCompletionDate($event)"
                            [showError] = "showError"
                            >
            </msp-school-date>
        </div>
        
    </div>


</div>
</form>
<hr class="strong-hr">

<!-- switch *ngIf value to true for debugging-->
<div class="row" *ngIf='false'>
    <div class="col-lg-12">
        <ul>
            <li *ngFor='let log of changeLog'>
                {{log | json}}
            </li>
        </ul>
    </div>

    <div class="col-lg-12">
        <p>Person Data Model</p>
        {{this.person| json}}
        <p>firstname</p>
        <!--{{ formRef.controls.firstname | json}}-->
    </div>
</div>
